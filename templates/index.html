<style>
    .chart-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    canvas {
      margin: 10px;
    }
  </style>


<div class="chart-container">
    <canvas width="420" height="240" id="myChart1"></canvas>
    <canvas width="420" height="240" id="myChart2"></canvas>
    <canvas width="420" height="240" id="myChart3"></canvas>
    <canvas width="420" height="240" id="myChart4"></canvas>
    <canvas width="420" height="240" id="myChart5"></canvas>
    <canvas width="420" height="240" id="myChart6"></canvas>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- <script type="text/javascript" src="../static/data.js"></script> -->
  <!-- import PapaParse library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  
<script>
    window.onload = function() {
        fetch('/static/data.csv')
            .then(response => response.text())
            .then(data => {
                Papa.parse(data, {
                    header: true,
                    dynamicTyping: true,
                    complete: function(results) {
                        const labels = results.data.map(row => row.Time);
                        const colors = [
                            'red', 'blue', 'green', 'orange', 'purple', 'cyan',
                            'magenta', 'yellow', 'lime', 'pink', 'teal', 'lavender'
                        ]; // 可以添加更多顏色
    
                        const chartGroups = {
                            myChart1: [],
                            myChart2: [],
                            myChart3: [],
                            myChart4: [],
                            myChart5: [],
                            myChart6: []
                        };
    
                        const columns = Object.keys(results.data[0]);
                        const deviceColors = {};
    
                        columns.forEach((col, colIndex) => {
                            const match = col.match(/(\d+)_(Hashrate|Fan1|Fan2|BtempIntake|BtempExhust|BtempMax|CtempMax|CtempMin|CtempAvg|CvoltageAvg|CclockAvg)/);
                            if (match) {
                                const device = match[1];
                                const metric = match[2];
    
                                if (!deviceColors[device]) {
                                    deviceColors[device] = colors[Object.keys(deviceColors).length % colors.length];
                                }
    
                                const color = deviceColors[device];
                                const dataset = {
                                    label: col,
                                    data: results.data.map(row => row[col]),
                                    borderColor: color,
                                    borderWidth: 1,
                                    fill: false
                                };
    
                                if (metric === 'Hashrate') {
                                    chartGroups.myChart1.push(dataset);
                                } else if (metric === 'Fan1' || metric === 'Fan2') {
                                    chartGroups.myChart2.push(dataset);
                                } else if (metric === 'BtempIntake' || metric === 'BtempExhust' || metric === 'BtempMax') {
                                    chartGroups.myChart3.push(dataset);
                                } else if (metric === 'CtempMax' || metric === 'CtempMin' || metric === 'CtempAvg') {
                                    chartGroups.myChart4.push(dataset);
                                } else if (metric === 'CvoltageAvg') {
                                    chartGroups.myChart5.push(dataset);
                                } else if (metric === 'CclockAvg') {
                                    chartGroups.myChart6.push(dataset);
                                }
                            }
                        });
    
                        Object.keys(chartGroups).forEach((chartId, index) => {
                            if (chartGroups[chartId].length > 0) {
                                const ctx = document.getElementById(chartId).getContext('2d');
                                new Chart(ctx, {
                                    type: 'line',
                                    data: {
                                        labels: labels,
                                        datasets: chartGroups[chartId]
                                    },
                                    options: {
                                        responsive: false,
                                        scales: {
                                            y: {
                                                beginAtZero: true
                                            }
                                        }
                                    }
                                });
                            }
                        });
                    }
                });
            })
            .catch(error => console.error('Error fetching the CSV file:', error));
    };
    </script>